# 理论介绍
## 为什么需要持久化
为了让数据在服务器出现问题时数据不会丢失

为了高可用

# 持久化两种方式
![[Pasted image 20240706180901.png]]

* RDB：Redis DataBase
* AOF：Append Only File

## RDB
### 简介
RDB持久性以执行的时间间隔执行数据集的**时间点快照**

按照指定的时间间隔执行对数据库的快照

这个快照文件就是RDB文件(dump.rdb)，恢复的时候就把这个文件读入内存

<span style="color:rgb(255, 0, 0)">这种快照是全量备份</span> 

### 案例演示
#### 需求说明
![[Pasted image 20240706181633.png]]
#### 配置文件(redis6和7不同)
##### Redis6.0.16以下
这是自动触发的
![[Pasted image 20240706181922.png]]

##### Redis6.2以及Redis7.0.0
![[Pasted image 20240706182219.png]]
和6来说，时间间隔变大了，保存的没有那么频繁了
而且配置文件的写的格式也变了

#### 操作步骤
##### 自动触发
###### 修改配置文件
修改为每5秒有2次修改就保存
![[Pasted image 20240706194623.png]]

修改把dump.rdb保存到`/home/ymc/myredis/dumpfiles`目录下，这个路径需要先创建，不能为空
![[Pasted image 20240706194932.png]]

指定文件保存名字，如果是集群部署，最好改为dump + 端口号 + .rdb，来做区分
![[Pasted image 20240706195018.png]]

###### 检查配置文件
在redis-cli执行
```
#查看登录密码
config get requirepass
```

```
#获取登录端口
config get port
```

```
#获取文件保存路径
config get dir 
```

##### 如何恢复
* 将备份文件移动到redis安装目录（实际就是你配置文件里面写的dump文件的保存位置）并启动服务即可
* 当我们进行了一个对数据库影响比较大的，比如`flushdb`,<span style="color:rgb(255, 0, 0)">即使不满足条件，数据库也会写入磁盘</span>
* 当我们执行`shutdown`，也会自动产生`dump.rdb`文件
* 物理备份有特殊意义的备份文件时，一定要做到分机隔离，防止和生产环境产生冲突
##### 手动触发
手动触发会自动`fork`c
###### save

###### bgsave
